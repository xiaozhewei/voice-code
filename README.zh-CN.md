# VoiceCode — 中文说明

VoiceCode 是一个在桌面与手机之间共享终端的小工具：桌面用于查看输出与键盘编辑，手机用于语音输入、快捷操作与直接命令触发，两个端实时连接到同一 PTY 会话。

---

## 安装（放最前）

前置：已安装 Node.js。

方式 A（推荐）：

```bash
npx voicecode
```

方式 B（全局安装）：

```bash
npm install -g voicecode
voicecode
```

方式 C（源码运行）：

```bash
npm install
npm start
```

服务默认启动在 `https://localhost:3000`（HTTPS + 自签名证书），首次打开浏览器会提示证书风险，需要手动信任。

---

## 快速开始（3 步）

1) 启动服务：

```bash
voicecode
# 或：npm start
```

2) 桌面端打开页面（`https://localhost:3000` 或日志中显示的地址）。

3) 手机扫码加入（点击页面二维码按钮，扫码后在手机浏览器打开会话）。

---

## 语音功能

语音识别在浏览器端进行，使用 SenseVoiceSmall（ONNX）模型，优先在 Web Worker 中推理以减少卡顿。首次使用会下载模型，浏览器会缓存后续加速。

主要模式：

- 按住说话（PTT）：手机端按住麦克风按钮录音，桌面端支持右侧 Alt（AltRight）/鼠标中键按住录音；松开后转写。
- 直接呼叫命令：以 `/` 开头的内容会立即发送到后端并回车执行；支持智能匹配与别名触发（例如说“帮助”执行 `/help`）。
- 口述输入（不自动回车）：非命令文本追加到当前输入行，便于编辑后手动回车执行。

模型与排障：

- 页面会尝试预热模型以减少首次按下 PTT 的等待。
- 设置中提供“清理语音模型缓存”选项（清理后需刷新页面重新拉取模型）。
- 若手机浏览器提示无麦克风或权限被拒绝，请确保通过 HTTPS 访问并授予麦克风权限。

---

## 二维码功能（更友好说明）

点击页面的二维码按钮会弹出一个可扫码图片。扫码即可在手机浏览器打开相同会话并加入。

如果手机和电脑在同一局域网，二维码会优先使用局域网地址；开启隧道/公网访问时会改为公网链接，方便远程扫码。

也可以点击“新会话”按钮打开一个新的会话并为其生成二维码。

---

## 其它核心特性

- 多端实时同步：同一个 PTY 会话可同时连接桌面与手机。
- 快速操作抽屉：一键发送常用命令；支持编辑、重命名及为命令设置别名（用于语音触发）。
- 自动启动 AI 命令行工具：支持启动时自动输入 `gemini` 或 `claude` 等。

---

## 高级用法

1) 内网穿透 / 公网访问（ngrok）：

```powershell
setx NGROK_AUTHTOKEN "<your-token>"
voicecode --tunnel
```

或从源码：

```bash
npm run start:tunnel
```

2) 启动时自动运行 AI 命令行工具：

```bash
voicecode --gemini
voicecode --claude
```

---

## 常见问题与排障

问：手机扫码能打开页面，但语音按钮不可用？

答：浏览器通常要求 HTTPS 与用户手势才能启用麦克风，请确认通过 `https://...` 访问并允许麦克风权限。

问：第一次语音很慢？

答：首次需要下载语音模型；后续使用缓存加速。可在设置中清理模型缓存并刷新页面以强制重新下载。

问：Windows 下终端启动失败/权限问题？

答：可尝试运行修复脚本：

```bash
node scripts/fix-node-pty-perms.js
```

---

## 许可证

ISC
